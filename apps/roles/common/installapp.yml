- name: Delete {{appname}} dir for sec_installation
  shell: rm -rf /data/apps/{{appname}}

- name: Clone {{appname}} in Websoft9
  git:
    repo: "https://github.com/Websoft9/docker-{{appname}}.git"
    dest: /data/apps/{{appname}}

- name: Rename and Run docker-compose
  shell: |
    docker-compose up -d
    sleep 30
  args:
    chdir: "/data/apps/{{appname}}"

- name: Recursively create directory for {{appname}}
  file:
    path: "{{ item }}"
    state: directory
    recurse: yes
  with_items:
    - "/data/apps/{{appname}}/volumes"

- name: Create docker self volumes to {{appname}}
  file:
    src: "{{item.src}}"
    dest: "{{item.dest}}"
    state: link
    force: yes
  with_items:
    - {src: "/var/lib/docker/volumes/discuzq_discuzq/_data", dest: "{{discuzq_root_directory}}/volumes/discuzq"}
    - {src: "/var/lib/docker/volumes/discuzq-mysql/_data", dest: "{{discuzq_root_directory}}/volumes/mysql"}
